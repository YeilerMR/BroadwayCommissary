<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /BroadwayCommissary/

    # Route API requests to api router first (ensure API endpoints are handled)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^api/(.*)$ api/router.php?endpoint=$1 [QSA,L]

    # Remove .php extension from non-API URLs
    RewriteCond %{REQUEST_URI} !^/BroadwayCommissary/api/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^([^.]+)$ $1.php [L]

    # Prevent direct access to includes folder
    RewriteRule ^includes/ - [F,L]

    # Security headers
    <FilesMatch "\.(php|phtml|php3|php4|php5|phtml|phps)$">
        Header set X-Content-Type-Options "nosniff"
        Header set X-Frame-Options "SAMEORIGIN"
    </FilesMatch>
</IfModule>

# Prevent directory listing
Options -Indexes

# PHP Configuration
<IfModule mod_php.c>
    php_flag display_errors off
    php_flag log_errors on
    php_value error_log /var/log/php_errors.log
</IfModule>
